<div class="container-fluid">
  <h1 class="dash-title">Profile</h1>
  <p class="mb-5">
    Here you will find all the information from you profile including the exam
    structures, subjects and terms.
  </p>
  <div class="row">
    <div class="col-xl-4">
      <div class="card-custom hovercard-custom card spur-card">
        <div class="card-customheader card-body"></div>
        <div class="avatar">
          <img
            alt=""
            src="https://ableelite.com/wp-content/uploads/2016/06/avatar_square_blue_512dp.png"
          />
        </div>
        <div class="spinner text-center" *ngIf="!profile">
          <div
            class="spinner-grow text-secondary"
            style="width: 3rem; height: 3rem"
            role="status"
          >
            <span class="sr-only">Loading...</span>
          </div>
        </div>
        <div class="info" *ngIf="profile">
          <div class="title">
            <a target="_blank" href="https://scripteden.com/">{{
              profile.full_name
            }}</a>
          </div>
          <div class="desc">
            <span class="desc-title">Username:</span>&nbsp;{{
              profile.username
            }}
          </div>
          <div class="desc">
            <span class="desc-title">Email:</span>&nbsp;{{ profile.email }}
          </div>
        </div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="col-xl-8">
      <div class="card spur-card">
        <div class="card-header bg-secondary">
          <div class="spur-card-icon text-white">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="spur-card-title text-white">Exam Structure</div>
          <div class="spur-card-menu">
            <button class="btn text-white" (click)="openExamAddModal()">
              <i class="fas fa-plus"></i>
            </button>
            <button class="btn text-white" (click)="openExamEditModal()">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn text-white" (click)="openExamDeleteModal()">
              <i class="fas fa-minus"></i>
            </button>
          </div>
          
        </div>
        <div class="card-body">
          <div class="spinner text-center" *ngIf="!chartOptions1">
            <div
              class="spinner-grow text-secondary"
              style="width: 3rem; height: 3rem"
              role="status"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <div class="container4">
            <div class="row">
              <div id="col" *ngIf="chartOptions1">
                <p>Total No. Of Exams For Each Subjects</p>
                <apx-chart
                  [series]="chartOptions1.series"
                  [chart]="chartOptions1.chart"
                  [labels]="chartOptions1.labels"
                  [fill]="chartOptions1.fill"
                  [dataLabels]="chartOptions1.dataLabels"
                  [responsive]="chartOptions1.responsive"
                ></apx-chart>
              </div>

              <div id="col" *ngIf="chartOptions2">
                <p>Full Marks For Each Exam</p>
                <apx-chart
                  [series]="chartOptions2.series"
                  [chart]="chartOptions2.chart"
                  [labels]="chartOptions2.labels"
                  [fill]="chartOptions2.fill"
                  [dataLabels]="chartOptions2.dataLabels"
                  [responsive]="chartOptions2.responsive"
                  [theme]="chartOptions2.theme"
                ></apx-chart>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card spur-card">
        <div class="card-header bg-primary text-white">
          <div class="spur-card-icon">
            <i class="fas fa-clipboard"></i>
          </div>
          <div class="spur-card-title">Subject List Added</div>
          <div class="spur-card-menu">
            <button class="btn text-white" (click)="openSubjectModal()">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="spinner text-center" *ngIf="!subjectListAny">
            <div
              class="spinner-grow text-secondary"
              style="width: 3rem; height: 3rem"
              role="status"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <table
            class="table table-hover table-in-card"
            *ngIf="subjectListAny && subjectListAny.length > 0"
          >
            <thead>
              <tr>
                <th scope="col" class="text"><span>Subject</span></th>
                <th scope="col" class="text"><span>Term</span></th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let val of subjectListAny"
                routerLink="/dash/subject/{{ val.sub_id }}"
                class="cursor-pointer"
              >
                <ng-container>
                  <th class="text">
                    <span>{{ val.subject_name }}</span>
                  </th>
                  <td class="text">
                    <span>{{ val.term_name }}</span>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </table>

          <p
            class="mt-4 lead"
            *ngIf="subjectListAny && subjectListAny.length <= 0"
          >
            Please enter a subject to see the subject in this list
          </p>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card spur-card">
        <div class="card-header bg-warning text-white">
          <div class="spur-card-icon">
            <i class="fas fa-clipboard"></i>
          </div>
          <div class="spur-card-title">Term List</div>
          <div class="spur-card-menu">
            <button class="btn text-white" (click)="openTermAddModal()">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="spinner text-center" *ngIf="!termData">
            <div
              class="spinner-grow text-secondary"
              style="width: 3rem; height: 3rem"
              role="status"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <table class="table table-hover table-in-card" *ngIf="termData?.response && termData?.response.length > 0">
            <thead>
              <tr>
                <th scope="col" class="text"><span>#</span></th>
                <th scope="col" class="text"><span>Term Name</span></th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let val of termData.response; let i = index"
                routerLink="/dash/term/{{ val.term_id }}"
              >
                <th class="text">
                  <span>{{ i + 1 }}</span>
                </th>
                <td class="text">
                  <span>{{ val.term_name }}</span>
                </td>
              </tr>
            </tbody>
          </table>
          <p
          class="mt-4 lead"
          *ngIf="termData?.response && termData.response.length <= 0"
        >
          Please enter a term to see the term in this list
        </p>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card spur-card">
        <div class="card-header bg-success text-white">
          <div class="spur-card-icon">
            <i class="fas fa-grin"></i>
          </div>
          <div class="spur-card-title">Subjects With Score Above Average</div>
        </div>
        <div class="card-body" *ngIf="subjectList">
          <table class="table table-hover table-in-card">
            <thead>
              <tr>
                <th scope="col" class="text"><span>Subject</span></th>
                <th scope="col" class="text"><span>Term</span></th>
                <th scope="col" class="text"><span>Score Average</span></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let val of subjectList">
                <ng-container *ngIf="val.average >= subjectAverage">
                  <th class="text">
                    <span>{{ val.subject_name }}</span>
                  </th>
                  <td class="text">
                    <span>{{ val.term_name }}</span>
                  </td>
                  <td class="text">
                    <span>{{ val.average }}</span>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card spur-card">
        <div class="card-header bg-danger text-white">
          <div class="spur-card-icon">
            <i class="fas fa-frown"></i>
          </div>
          <div class="spur-card-title">Subjects With Score Below Average</div>
        </div>
        <div class="card-body" *ngIf="subjectList">
          <table class="table table-hover table-in-card">
            <thead>
              <tr>
                <th scope="col" class="text"><span>Subject</span></th>
                <th scope="col" class="text"><span>Term</span></th>
                <th scope="col" class="text"><span>Score Average</span></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let val of subjectList">
                <ng-container *ngIf="val.average < subjectAverage">
                  <th class="text">
                    <span>{{ val.subject_name }}</span>
                  </th>
                  <td class="text">
                    <span>{{ val.term_name }}</span>
                  </td>
                  <td class="text">
                    <span>{{ val.average }}</span>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!--Term Wise Subjects Organised-->
    <div class="col-xl-6" *ngFor="let val of termData?.response">
      <div class="card spur-card">
        <div class="card-header bg-info text-white">
          <div class="spur-card-icon">
            <i class="fas fa-clipboard"></i>
          </div>
          <div class="spur-card-title">
            No. Of Subjects in {{ val.term_name }}
          </div>
        </div>
        <div class="card-body" >
          <table class="table table-hover table-in-card">
            <thead>
              <tr>
                <th scope="col" class="text"><span>#</span></th>
                <th scope="col" class="text"><span>Subject Name</span></th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let v of val.subjects; let i = index"
                routerLink="/dash/subject/{{ v.sub_id }}"
                class="cursor-pointer"
              >
                <th class="text">
                  <span>{{ i + 1 }}</span>
                </th>
                <td class="text">
                  <span>{{ v.sub_name }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!--EXAM ADD MODAL -->
<div class="modal fade" [ngClass]="{ show: showExamModal }">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Exam Structure</h5>
        <button type="button" class="close" (click)="showExamModal = false">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="form">
          <div class="form-group">
            <input
              type="text"
              formControlName="examname"
              class="form-control"
              placeholder="Exam Name"
            />
            <small
              *ngIf="f.examname.touched && f.examname.invalid"
              class="form-text text-danger font-weight-bold"
            >
              <div *ngIf="f.examname.errors.required">
                Please Enter Exam Name
              </div>
            </small>
          </div>
          <div class="form-group">
            <input
              type="text"
              formControlName="totalexam"
              class="form-control"
              placeholder="Total No. Of Exams for Each Subject In a Term"
            />
            <small
              *ngIf="f.totalexam.touched && f.totalexam.invalid"
              class="form-text text-danger font-weight-bold"
            >
              <div *ngIf="f.totalexam.errors.required">
                Please Enter Total Exams
              </div>
              <div *ngIf="f.totalexam.errors.pattern">
                Can contain only Numeric value
              </div>
            </small>
          </div>
          <div class="form-group">
            <input
              type="text"
              formControlName="exammarks"
              class="form-control"
              id="formGroupExampleInput3"
              placeholder="Full Marks"
            />
            <small
              *ngIf="f.exammarks.touched && f.exammarks.invalid"
              class="form-text text-danger font-weight-bold"
            >
              <div *ngIf="f.exammarks.errors.required">
                Please Enter Full Marks
              </div>
              <div *ngIf="f.exammarks.errors.pattern">
                Can contain only Numeric value
              </div>
            </small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          [disabled]="!form.valid"
          (click)="addexam()"
        >
          Add
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="showExamModal = false"
          data-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>


<!--EXAM Delete MODAL -->
<div class="modal fade" [ngClass]="{ show: showDeleteExamModal }">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Exam</h5>
        <button type="button" class="close" (click)="showDeleteExamModal = false">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="spinner text-center" *ngIf="!PieData">
            <div
              class="spinner-grow text-secondary"
              style="width: 3rem; height: 3rem"
              role="status"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <div
            class="row"
            *ngIf="PieData"
          >
          <div class="col-md-12">
            <form [formGroup]="deleteExamForm">
          <label for="exampleFormControlSelect1">Select Exam</label>
                <select
                  class="form-control"
                  formControlName="exam_id"
                >
                  <option value="" selected>Select</option>
                  <option
                    [value]="exam.ass_id"
                    *ngFor="let exam of PieData.response"
                  >
                    {{ exam.exam_name }}
                  </option>
                </select>
                <small
                  *ngIf="
                  deleteExamForm.get('exam_id').touched &&
                  deleteExamForm.get('exam_id').invalid
                  "
                  class="form-text text-danger font-weight-bold"
                >
                  <div *ngIf="deleteExamForm.get('exam_id').errors.required">
                    Please select a Exam
                  </div>
                </small>
            </form>
      </div>
        </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          [disabled]="!deleteExamForm.valid"
          (click)="onDeleteExam()"
        >
          Delete
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="showDeleteExamModal = false"
          data-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!--EXAM Update MODAL -->
<div class="modal fade" [ngClass]="{ show: showEditExamModal }">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Exam Name</h5>
        <button type="button" class="close" (click)="showEditExamModal = false">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="spinner text-center" *ngIf="!PieData">
            <div
              class="spinner-grow text-secondary"
              style="width: 3rem; height: 3rem"
              role="status"
            >
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <form [formGroup]="EditExamForm">
          <div
            class="row"
            *ngIf="PieData"
          >
          
          <div class="col-md-6">
            
          <label for="exampleFormControlSelect1">Select Exam</label>
                <select
                  class="form-control"
                  formControlName="exam_id"
                >
                  <option value="" selected>Select</option>
                  <option
                    [value]="exam.ass_id"
                    *ngFor="let exam of PieData.response"
                    
                  >
                    {{ exam.exam_name }}
                  </option>
                </select>
                <small
                  *ngIf="
                  EditExamForm.get('exam_id').touched &&
                  EditExamForm.get('exam_id').invalid
                  "
                  class="form-text text-danger font-weight-bold"
                >
                  <div *ngIf="EditExamForm.get('exam_id').errors.required">
                    Please select a Exam
                  </div>
                </small>
            
      </div>

      <div class="col-md-6">
        <div class="form-group">
          <label for="exampleFormControlInput1">New Exam Name</label>
          <input
            type="text"
            class="form-control"
            
            formControlName="new_exam_name"
            placeholder="eg. Internals,Finals"
          />
          <small
            *ngIf="
            EditExamForm.get('new_exam_name').touched &&
            EditExamForm.get('new_exam_name').invalid
            "
            class="form-text text-danger font-weight-bold"
          >
            <div *ngIf="EditExamForm.get('new_exam_name').errors.required">
              Please enter Exam Name
            </div>
          </small>
        </div>
      </div>
    
        </div>
      </form>
          </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-primary"
          [disabled]="!EditExamForm.valid"
          (click)="onUpdateExam()"
        >
          Update
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="showEditExamModal = false"
          data-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!---Add subject Modal-->
<div
  id="myModal"
  class="modal fade"
  role="dialog"
  [ngClass]="{ show: showSubjectAddModal }"
>
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <form [formGroup]="addSubjectForm" (ngSubmit)="onAddSubject()">
        <div class="modal-header">
          <h5 class="m-0">Add a subject</h5>
          <button
            type="button"
            class="close btn btn-danger"
            data-dismiss="modal"
            (click)="showSubjectAddModal = false"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="spinner text-center" *ngIf="!termListDropDown">
              <div
                class="spinner-grow text-secondary"
                style="width: 3rem; height: 3rem"
                role="status"
              >
                <span class="sr-only">Loading...</span>
              </div>
            </div>
            <div
              class="row"
              *ngIf="termListDropDown && termListDropDown.length > 0"
            >
              <div class="col-md-6">
                <div class="form-group">
                  <label for="exampleFormControlInput1">Subject Name</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="sub_name"
                    placeholder="eg. Physics"
                  />
                  <small
                    *ngIf="
                      addSubjectForm.get('sub_name').touched &&
                      addSubjectForm.get('sub_name').invalid
                    "
                    class="form-text text-danger font-weight-bold"
                  >
                    <div *ngIf="addSubjectForm.get('sub_name').errors.required">
                      Please enter subject
                    </div>
                  </small>
                </div>
              </div>
              <div class="col-md-6">
                <label for="exampleFormControlSelect1">Select Term</label>
                <select
                  class="form-control"
                  formControlName="term_id"
                  (change)="changeTermId($event)"
                >
                  <option value="" selected>Select</option>
                  <option
                    [value]="term.term_id"
                    *ngFor="let term of termListDropDown"
                  >
                    {{ term.term_name }}
                  </option>
                </select>
                <small
                  *ngIf="
                    addSubjectForm.get('term_id').touched &&
                    addSubjectForm.get('term_id').invalid
                  "
                  class="form-text text-danger font-weight-bold"
                >
                  <div *ngIf="addSubjectForm.get('term_id').errors.required">
                    Please select a term
                  </div>
                </small>
              </div>
            </div>
            <p
              class="lead"
              *ngIf="termListDropDown && termListDropDown.length <= 0"
            >
              You need to add a term first before adding a subject.
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="submit"
            class="btn btn-primary"
            *ngIf="termListDropDown && termListDropDown.length > 0"
            [disabled]="!addSubjectForm.valid"
          >
            Add
          </button>
          <button
            type="button"
            class="btn btn-danger"
            data-dismiss="modal"
            (click)="showSubjectAddModal = false"
          >
            Close
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!--Add Term Modal-->
<div class="modal" id="myModal" [ngClass]="{ show: showAddTermModal }">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Add Term</h4>
        <button
          type="button"
          class="close"
          (click)="showAddTermModal = false"
          data-dismiss="modal"
        >
          &times;
        </button>
      </div>
      <!-- Modal body -->
      <div class="modal-body">
        <form
          #userpost="ngForm"
          [formGroup]="termAddForm"
          (ngSubmit)="onAddTerm()"
        >
          <div class="form-group">
            <label for="exampleInputEmail1" class="font-weight-bold"
              >Term Name :
            </label>
            <input
              type="text"
              class="form-control"
              formControlName="term_name"
              id="exampleInputEmail1"
              aria-describedby="emailHelp"
              placeholder="Enter Term"
            />

            <small
              *ngIf="term_name_add.touched && term_name_add.invalid"
              class="form-text text-danger font-weight-bold"
            >
              <div *ngIf="term_name_add.errors?.required">
                Term Name is required
              </div>
            </small>
          </div>
          <div class="forms-group text-center">
            <button
              [disabled]="!termAddForm.valid"
              class="btn btn-primary mr-3"
              type="submit"
            >
              Submit
            </button>
          </div>
        </form>
      </div>

      <!-- Modal footer 
      <div class="modal-footer">
        <button type="submit" class="btn btn-danger" (click)="showAddTermModal=false" data-dismiss="modal">Close</button>
      </div>-->
    </div>
  </div>
</div>
